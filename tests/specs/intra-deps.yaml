- name: restore_eth_firehose
  restore: _/eth_firehose@0.0.0

- name: deploy_intra_deps
  deploy: intra_deps
  end: 15000000

- name: dump_intra_deps
  dataset: _/intra_deps@0.1.0
  end: 15000000
  config: amp.config.ts

- name: query_blocks_base
  query: SELECT * from intra_deps.zz_blocks_base order by block_num limit 1
  results: |
    [
      {"_block_num":15000000,"block_num":15000000,"gas_limit":30000000,"gas_used":29998802,"hash":"9a71a95be3fe957457b11817587e5af4c7e24836d5b383c430ff25b9286a457f","miner":"ea674fdde714fd979de3edf0f56aa9716b898ec8","nonce":11581608188404422748,"parent_hash":"93a8a23a2f5296db7251ab4c5e9b10bdc5a6c9c4ed56fb230dc729d3dc03a138"}
    ]

- name: query_aa_blocks_derived
  query: SELECT * from intra_deps.aa_blocks_derived order by block_num limit 1
  results: |
    [
      {"_block_num":15000000,"block_num":15000000,"gas_limit":30000000,"gas_used":29998802,"hash":"9a71a95be3fe957457b11817587e5af4c7e24836d5b383c430ff25b9286a457f","miner":"ea674fdde714fd979de3edf0f56aa9716b898ec8","parent_hash":"93a8a23a2f5296db7251ab4c5e9b10bdc5a6c9c4ed56fb230dc729d3dc03a138"}
    ]

- name: query_mm_blocks_derived
  query: SELECT * from intra_deps.mm_blocks_derived order by block_num limit 1
  results: |
    [
      {"_block_num":15000000,"block_num":15000000,"hash":"9a71a95be3fe957457b11817587e5af4c7e24836d5b383c430ff25b9286a457f","miner":"ea674fdde714fd979de3edf0f56aa9716b898ec8","parent_hash":"93a8a23a2f5296db7251ab4c5e9b10bdc5a6c9c4ed56fb230dc729d3dc03a138"}
    ]

- name: query_count_blocks_base
  query: SELECT count(*) as total_blocks from intra_deps.zz_blocks_base
  results: |
    [
      {"total_blocks":1}
    ]

- name: query_count_blocks_derived
  query: SELECT count(*) as total_blocks from intra_deps.aa_blocks_derived
  results: |
    [
      {"total_blocks":1}
    ]

- name: query_count_mm_blocks_derived
  query: SELECT count(*) as total_blocks from intra_deps.mm_blocks_derived
  results: |
    [
      {"total_blocks":1}
    ]

- name: query_non_existent_field_aa_blocks_derived
  query: SELECT nonce from intra_deps.aa_blocks_derived
  failure: |
    No field named nonce. Valid fields are intra_deps.aa_blocks_derived._block_num, intra_deps.aa_blocks_derived.block_num, intra_deps.aa_blocks_derived.gas_limit, intra_deps.aa_blocks_derived.gas_used, intra_deps.aa_blocks_derived.miner, intra_deps.aa_blocks_derived.hash, intra_deps.aa_blocks_derived.parent_hash

- name: query_non_existent_field_mm_blocks_derived
  query: SELECT gas_limit from intra_deps.mm_blocks_derived
  failure: |
    No field named gas_limit. Valid fields are intra_deps.mm_blocks_derived._block_num, intra_deps.mm_blocks_derived.block_num, intra_deps.mm_blocks_derived.miner, intra_deps.mm_blocks_derived.hash, intra_deps.mm_blocks_derived.parent_hash
