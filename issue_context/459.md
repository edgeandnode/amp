# Move input_batch_size_blocks into StreamingQuery

Microbatch size control can be a StreamingQuery responsibility. Steps:

1. Add a test for input_batch_size_blocks
2. Refactor it into StreamingQuery
3. Rename to microbatch_max_interval or something
4. Move to config file

# 1. Add a test for input_batch_size_blocks

## Objective
Test that `input_batch_size_blocks` parameter controls Parquet file granularity during SQL dataset dumps.

## How it was fixed
Created test using `sql_stream_ds.even_blocks` that dumps data on-the-spot rather than restoring blessed data. Test validates that `input_batch_size_blocks=1` creates 4 files for 4 blocks, including empty files when SQL filter produces no results.

## Considerations for future work
- Parameter controls file creation at block level even when queries return no data
- Empty file generation behavior must be preserved during refactoring
- On-the-spot dumping approach removes dependency on blessed data availability

# 2. Refactor it into StreamingQuery

## Objective
Move batching logic from dump orchestration level into StreamingQuery to consolidate microbatch control responsibility.

## Planned approach
- Add mandatory `microbatch_max_interval` parameter to `StreamingQuery::spawn()`
- Remove manual batching loop from `dump_table()` in sql_dataset.rs (lines 209-232)
- Implement simple chunking inside StreamingQuery: split `[start, end_block]` into chunks of `microbatch_max_interval` and process sequentially
- Parameter is mandatory with no default value

# 3. Rename to microbatch_max_interval

## Objective
Rename parameter throughout codebase to reflect its role as a streaming query batching control.

## Planned approach
- Rename `input_batch_size_blocks` to `microbatch_max_interval` in all locations
- Update CLI parameter name and function signatures
- Update test helper functions and call sites

# 4. Move to config file

## Objective
Remove CLI parameter and enable per-dataset configuration of microbatch intervals.

## Planned approach
- Remove CLI parameter entirely
- Add `microbatch_max_interval` to dataset configuration files
- Allow per-dataset configuration rather than global setting
